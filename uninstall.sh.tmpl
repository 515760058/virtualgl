# Copyright (C)2009 Sun Microsystems, Inc.
#
# This library is free software and may be redistributed and/or modified under
# the terms of the wxWindows Library License, Version 3.1 or (at your option)
# any later version.  The full license is in the LICENSE.txt file included
# with this distribution.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# wxWindows Library License for more details.

#!/bin/sh

error()
{
	echo $1
	exit -1
}

if [ ! "`id -u`" = "0" ]; then
	error "This command must be run as root"
fi

PKGNAME={__APPNAME}
RCPT=/Library/Receipts/$PKGNAME.pkg

if [ ! -d $RCPT ]; then error "Could not find package receipt"; fi

echo Removing files ...
lsbom -s -f -l $RCPT/Contents/Archive.bom >/dev/null || error "Could not list package contents"
RETCODE=0
PWD=`pwd`
cd /
lsbom -s -f -l $RCPT/Contents/Archive.bom | while read line; do
	rm "$line" 2>&1 || RETCODE=-1
done
cd $PWD

echo Removing directories ...
rmdir /opt/VirtualGL/bin 2>&1 || RETCODE=-1
rmdir /opt/VirtualGL/lib 2>&1 || RETCODE=-1
rmdir /opt/VirtualGL 2>&1 || RETCODE=-1
rmdir /Library/Documentation/$PKGNAME 2>&1 || RETCODE=-1
rmdir /Applications/VirtualGL 2>&1 || RETCODE=-1

echo Removing package receipt $RCPT ...
rm -r $RCPT 2>&1 || error "Could not remove package receipt"

exit $RETCODE

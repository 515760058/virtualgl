#!/bin/sh

usage()
{
	echo
	echo "Usage: `basename $0` [options] [--] <OpenGL app> [OpenGL app arguments]"
	echo
	echo "VirtualGL display options"
	echo "  +/-spoil    : Turn on/off frame spoiling (default = on)"
	echo "  -d <d>      : set the display on which 3D rendering is done (default = :0.0)"
	echo "  -client <d> : set the client display (default = DISPLAY enviroment)"
	echo
	echo "VirtualGL network options"
	echo "  +/-s        : Enable/disable use of SSL (default = disabled)"
	echo "  -p <p>      : TCP port to use when connecting to client (default = 4242)"
	echo
	echo "VirtualGL compression options"
	echo "  -c <c>      : specify compression type (0=none, 1=motion JPEG)"
	echo "  -q <q>      : specify a quality value in the range [1-100]"
	echo "  -samp <s>   : specify YCbCr subsampling (444, 422, 411)"
	echo
	echo "VirtualGL miscellaneous options"
	echo "  +/-profile  : Enable/disable profiling"
	echo "  +debug      : Enable debugging"
	echo
	exit $1
}

GEOPROBE_USEGLX=1
export GEOPROBE_USEGLX
PROMAGIC_USEGLX=1
export PROMAGIC_USEGLX

if [ $# -eq 0 ]
then
	usage 0
fi
while [ $# -gt 0 ]
do
	case "$1" in
	+sp*)       RRSPOIL=1       ; export RRSPOIL    ;;
	-sp*)       RRSPOIL=0       ; export RRSPOIL    ;;
	-sa*)       RRSUBSAMP=$2    ; export RRSUBSAMP  ; shift     ;;
	-s*)        RRUSESSL=0      ; export RRUSESSL   ;;
	+s*)        RRUSESSL=1      ; export RRUSESSL   ;;
	-pr*)       RRPROFILE=0     ; export RRPROFILE  ;;
	+pr*)       RRPROFILE=1     ; export RRPROFILE  ;;
	-q*)        RRQUAL=$2       ; export RRQUAL     ; shift     ;;
	+de*)       RRDEBUGPAUSE=1  ; export RRDEBUGPAUSE ;;
	-d*)        RRDISPLAY=$2    ; export RRDISPLAY  ; shift     ;;
	-cl*)       RRCLIENT=$2     ; export RRCLIENT   ; shift     ;;
	-p*)        RRPORT=$2       ; export RRPORT     ; shift     ;;
	-c*)        RRCOMPRESS=$2   ; export RRCOMPRESS ; shift     ;;
	-ld)        LD_LIBRARY_PATH=$1:$LD_LIBRARY_PATH ;
	            export LD_LIBRARY_PATH              ; shift     ;;
	-h)         usage 0 ;;
	--help)     usage 0 ;;
	--)         shift   ; break ;;
	-*)         usage 1 ;;
	*)          break   ;;
	esac
	shift
done

case `uname -s` in

Linux)

LD_PRELOAD=librrfaker.so:libGL.so.1 ${1+"$@"}

;;

IRIX*)

_RLD_LIST=librrfaker.so:libGL.so:libC.so:libpthread.so:DEFAULT ${1+"$@"}

;;

SunOS)

FAKERLIB=librrfaker.so
if [ -f /opt/SUNWvgl/lib/sparcv9/librrfaker.so ]
then
	FAKERLIB=/opt/SUNWvgl/lib/sparcv9/librrfaker.so
fi
LD_PRELOAD_64=$FAKERLIB:libGL.so ${1+"$@"}

;;

esac

########################################
# Solaris x86 32-bit and 64-bit
########################################

ARCHFLAG =

ifeq ($(CC), gcc)

 CXX = g++
 CFLAGS = -Wall -fpic
 CDEFINES = -D_GNU_SOURCE

 ifeq ($(subplatform), 64)
  ARCHFLAG = -m64
 endif
 ifeq ($(DEBUG), yes)
  OPTFLAG = -O0 -ggdb
 else
  OPTFLAG = -O2
 endif
 SHFLAG = -shared -lc
 DEPFLAG = -MM
 MAPFLAG = -Wl,-M,

else

 CC = cc
 CXX = CC -norunpath
 CFLAGS = -xCC -Kpic -mt
 CXXFLAGS = -Kpic -mt
 LAZY = -zlazyload
 NOLAZY = -znolazyload

 ifeq ($(subplatform), 64)
  ARCHFLAG = -xtarget=opteron -xarch=amd64
 endif
 ifeq ($(DEBUG), yes)
  OPTFLAG = -g
 else
  OPTFLAG = -O
 endif
 SHFLAG = -G -lc -z direct -lCrun -z nodirect
 DEPFLAG = -xM1
 MAPFLAG = -M

endif

ifeq ($(NASM),)
NASM = nasm
endif
ifeq ($(subplatform), 64)
NAFLAGS = -felf64 -DELF -D__x86_64__
else
NAFLAGS = -felf -DELF
endif

AR = ar ruvs
INSTALL = /usr/ucb/install

CINCLUDES = -I/usr/X/include -I/usr/X11/include
MESAGLU := $(shell if [ -f /usr/X11/include/mesa/glu.h ]; then echo yes; fi)
ifeq ($(MESAGLU), yes)
 CDEFINES := $(CDEFINES) -DMESAGLU
endif

ifeq ($(USEGLP), yes)
 CDEFINES := $(CDEFINES) -DUSEGLP
endif
ifeq ($(USESSL), yes)
 CDEFINES := $(CDEFINES) -DUSESSL
endif

LDFLAGS = -mt -lpthread -lrt
ifeq ($(subplatform), 64)
 LDFLAGS := -L/usr/X/lib/64 -L/usr/X11/lib/64 -R/opt/SUNWvgl/lib/amd64 $(LDFLAGS)
else
 LDFLAGS := -L/usr/X/lib -L/usr/X11/lib -R/opt/SUNWvgl/lib $(LDFLAGS)
endif

DEFAULTJPEGLIB = medialib
LIBJPEG_SIMD = yes

SHEXT = so

FBXLIB = -lfbx -lX11 -lXext
SOCKLIB = -lrrsocket -lsocket -lxnet

ifeq ($(USESSL), yes)

 SSLDIR = $(TOPDIR)/../openssl.$(platform)$(subplatform)
 STATICSSL := $(shell if [ -f $(SSLDIR)/libssl.a -a -f $(SSLDIR)/libcrypto.a ]; then echo yes; fi)

 ifeq ($(STATICSSL), yes)

  CINCLUDES := $(CINCLUDES) -I$(SSLDIR)/include
  ifeq ($(CC), gcc)
   SSLLIB = -ldl -L$(SSLDIR) -Xlinker -Bstatic -Xlinker -lssl -Xlinker -lcrypto -Xlinker -Bdynamic
  else
   SSLLIB = -ldl -L$(SSLDIR) -Bstatic -lssl -lcrypto -Bdynamic
  endif

 else

  CINCLUDES := $(CINCLUDES) -I/usr/sfw/include
  ifeq ($(subplatform), 64)
   SSLLIB = -L/usr/sfw/lib/amd64 -R/usr/sfw/lib/amd64 -lssl -lcrypto
  else
   SSLLIB = -L/usr/sfw/lib -R/usr/sfw/lib -lssl -lcrypto
  endif

 endif

 SOCKLIB := $(SOCKLIB) $(SSLLIB)

endif

# Have to explicitly link libXm before libGL so Java apps don't barf
GLLIB = -lGL
FAKERLINK = $(GLLIB) -lm $(MAPFLAG)$(ODIR)/faker-mapfile.E

ZNOW = -z now
MLIB = -lmlib

USEXV = yes
